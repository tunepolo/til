<!doctype html><html lang=ja-jp><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>2.1形式のファイルを2.0形式に変換する - Today 'tunepolo' Leaned</title><meta name=generator content="Hugo 0.111.3"><link href=https://tunepolo.github.io/til//index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://tunepolo.github.io/til/circleci/convert_20_to_21/><link rel=stylesheet href=https://tunepolo.github.io/til/css/theme.min.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script>
<link rel=stylesheet href=https://tunepolo.github.io/til/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script>
<script src=https://tunepolo.github.io/til/js/bundle.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-165624930-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-165624930-1")</script><style>:root{--custom-background-color:#cc7db1}</style><meta property="og:title" content="2.1形式のファイルを2.0形式に変換する"><meta property="og:description" content="Workflowが使われていたり、Orbsが使われていると実行される設定が分かりにくくなる。 また2.1形式の設定ファイルはローカル実行もでき"><meta property="og:type" content="article"><meta property="og:url" content="https://tunepolo.github.io/til/circleci/convert_20_to_21/"><meta property="og:image" content="https://tunepolo.github.io/til/images/love-to-learn.jpg"><meta property="article:section" content="circleci"><meta property="article:modified_time" content="2020-05-05T17:51:53+09:00"><meta property="og:site_name" content="Today 'tunepolo' Leaned"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tunepolo.github.io/til/images/love-to-learn.jpg"><meta name=twitter:title content="2.1形式のファイルを2.0形式に変換する"><meta name=twitter:description content="Workflowが使われていたり、Orbsが使われていると実行される設定が分かりにくくなる。 また2.1形式の設定ファイルはローカル実行もでき"><meta itemprop=name content="2.1形式のファイルを2.0形式に変換する"><meta itemprop=description content="Workflowが使われていたり、Orbsが使われていると実行される設定が分かりにくくなる。 また2.1形式の設定ファイルはローカル実行もでき"><meta itemprop=dateModified content="2020-05-05T17:51:53+09:00"><meta itemprop=wordCount content="680"><meta itemprop=image content="https://tunepolo.github.io/til/images/love-to-learn.jpg"><meta itemprop=keywords content></head><body><div class=container><header><h1>Today 'tunepolo' Leaned</h1><a href=https://github.com/tunepolo/til class=github><i class="fab fa-github"></i></a></header><div class=global-menu><nav><ul><li><a href=/til/>Home</a></li><li><a href=/til/search>Search</a></li></ul></nav></div><div class=content-container><main><h1>2.1形式のファイルを2.0形式に変換する</h1><p>Workflowが使われていたり、Orbsが使われていると実行される設定が分かりにくくなる。
また2.1形式の設定ファイルはローカル実行もできない。</p><p>下記のやり方でOrbやJobs/Commandを展開し、2.1形式のファイルを2.0形式に変換した結果を入手できる。</p><pre tabindex=0><code>$ circleci config process .circleci/config.yml
# Orb &#39;sue445/ruby-orbs@1.4.3&#39; resolved to &#39;sue445/ruby-orbs@1.4.3&#39;
# Orb &#39;yasuhiroki/reviewdog@0.0.3&#39; resolved to &#39;yasuhiroki/reviewdog@0.0.3&#39;
version: 2
jobs:
  rails_minitest:
    working_directory: ~/workspace
    docker:
    - image: circleci/ruby:2.6.1-node-browsers
      environment:
        RAILS_ENV: test
    steps:
    - checkout
    - restore_cache:
        keys:
        - v1-bundle-{{ .Environment.CIRCLE_JOB }}-{{ checksum &#34;Gemfile.lock&#34; }}-{{
          .Branch }}
        - v1-bundle-{{ .Environment.CIRCLE_JOB }}-{{ checksum &#34;Gemfile.lock&#34; }}
        - v1-bundle-{{ .Environment.CIRCLE_JOB }}
        - v1-bundle
    - run:
        command: |
          set -xe
          bundle_install_args=&#34;--jobs=4 --retry=3 --path=vendor/bundle --gemfile=Gemfile&#34;

          bundle_install_args=&#34;$bundle_install_args --clean&#34;

          bundle_extra_args=&#34;&#34;
          if [ -n &#34;$bundle_extra_args&#34; ]; then
            bundle_install_args=&#34;$bundle_install_args $bundle_extra_args&#34;
          fi

          with_gemfile_lock=&#34;false&#34;
          with_gemfile_lock=&#34;true&#34;

          if [ $with_gemfile_lock == &#34;true&#34; ]; then
            bundle install $bundle_install_args
          else
            run_bundle_install=&#34;true&#34;

            if [ $run_bundle_install == &#34;true&#34; ]; then
              set +e
              bundle install $bundle_install_args
              ret=$?
              set -e
            else
              ret=1
            fi

            # Retry with `bundle update` if `bundle install` is failed
            if [ $ret -ne 0 ]; then
              # NOTE: `.bundle/config` is not created after `bundle install` is failed
              mkdir -p .bundle/
              echo &#39;---&#39; &gt; .bundle/config
              echo &#39;BUNDLE_PATH: &#34;vendor/bundle&#34;&#39; &gt;&gt; .bundle/config
              bundle update --jobs=4
            fi
          fi
        name: bundle install
    - run:
        command: |
          set -xe

          if [ &#34;Gemfile&#34; == &#34;Gemfile&#34; ]; then
            gem install restore_bundled_with --no-document
            restore-bundled-with
          fi
        name: restore-bundled-with
    - save_cache:
        key: v1-bundle-{{ .Environment.CIRCLE_JOB }}-{{ checksum &#34;Gemfile.lock&#34; }}-{{
          .Branch }}
        paths:
        - vendor/bundle
    - run:
        name: Database setup
        command: |
          bundle exec rails db:create
          bundle exec rails db:migrate
    - run:
        name: Setup Code Climate test-reporter
        command: |
          curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 &gt; ./cc-test-reporter
          chmod +x ./cc-test-reporter
    - run:
        name: Rails Minitest
        command: |
          ./cc-test-reporter before-build
          bundle exec rake test
          ./cc-test-reporter after-build --coverage-input-type simplecov --exit-code $?
  reviewdog/reviewdog:
    docker:
    - image: cagedata/rubocop
    steps:
    - checkout
    - run:
        name: Rubocop update
        command: gem update rubocop
    - run:
        command: rubocop --out lint_result.txt || true
    - store_artifacts:
        path: lint_result.txt
    - run:
        command: |
          test -f /usr/local/bin/reviewdog \
            || \
          wget https://github.com/haya14busa/reviewdog/releases/download/0.9.11/reviewdog_linux_amd64 -O /usr/local/bin/reviewdog \
            &amp;&amp; \
          chmod +x /usr/local/bin/reviewdog
    - run:
        command: |
          test ${CI_PULL_REQUEST} || exit 0
          cat lint_result.txt | reviewdog -f=rubocop -reporter=github-pr-review
workflows:
  continuous-integration:
    jobs:
    - rails_minitest
    - reviewdog/reviewdog
  version: 2

# Original config.yml file:
# version: 2.1
#
# orbs:
#   ruby-orbs: sue445/ruby-orbs@1.4.3
#   reviewdog: yasuhiroki/reviewdog@0.0.3
#
# executors:
#   default:
#     working_directory: ~/workspace
#     docker:
#       - image: circleci/ruby:2.6.1-node-browsers
#         environment:
#           RAILS_ENV: test
#
# commands:
#   lint:
#     parameters:
#       lint_result_file_path:
#         description: Lint result file path
#         type: string
#     steps:
#       - checkout
#       - run:
#           name: Rubocop update
#           command: gem update rubocop
#       - run: rubocop --out &lt;&lt;parameters.lint_result_file_path&gt;&gt; || true
#       - store_artifacts:
#           path: &lt;&lt;parameters.lint_result_file_path&gt;&gt;
#
# jobs:
#   rails_minitest:
#     executor:
#       name: default
#     steps:
#       - checkout
#       - ruby-orbs/bundle-install:
#           bundle_clean: true
#           bundle_extra_args: &#39;&#39;
#           bundle_gemfile: Gemfile
#           bundle_jobs: 4
#           bundle_path: vendor/bundle
#           bundle_retry: 3
#           cache_key_prefix: v1-bundle
#           restore_bundled_with: true
#       # \u521D\u671F\u8A2D\u5B9A
#       - run:
#           name: Database setup
#           command: |
#             bundle exec rails db:create
#             bundle exec rails db:migrate
#       # Download test-reporter
#       - run:
#           name: Setup Code Climate test-reporter
#           command: |
#             curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 &gt; ./cc-test-reporter
#             chmod +x ./cc-test-reporter
#       - run:
#           name: Rails Minitest
#           command: |
#             ./cc-test-reporter before-build
#             bundle exec rake test
#             ./cc-test-reporter after-build --coverage-input-type simplecov --exit-code $?
#
# workflows:
#   continuous-integration:
#     jobs:
#       - rails_minitest
#       - reviewdog/reviewdog:
#           linter_image: cagedata/rubocop
#           reviewdog_format_option: &#39;-f=rubocop&#39;
#           run_linter_steps:
#             - lint:
#                 lint_result_file_path: lint_result.txt
#           lint_result_file_path: lint_result.txt
</code></pre><div class=edit-meta>Last updated on 5 May 2020<br><a href=https://github.com/tunepolo/til/edit/master/content/circleci/convert_20_to_21.md class=edit-page><i class="fas fa-pen-square"></i> Edit on GitHub</a></div><nav class=pagination><a class="nav nav-prev" href=https://tunepolo.github.io/til/circleci/ title=CircleCI><i class="fas fa-arrow-left" aria-hidden=true></i> Prev - CircleCI</a>
<a class="nav nav-next" href=https://tunepolo.github.io/til/circleci/local_config_validate/ title=CircleCIの設定ファイルをローカルで検証する>Next - CircleCIの設定ファイルをローカルで検証する <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://tunepolo.github.io/til/>Home</a></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/algorithm/>Algorithm<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/algorithm/levenstein_distance/>レーベンシュタイン距離</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/architecture/>Architecture<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/architecture/strangler_pattern/>ストラングラーパターン</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/aws/>AWS<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/aws/region_and_az/>リージョンとAZ</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/centos/>CentOS<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/centos/version_check/>バージョンの確認方法</a></li></ul></li><li class="parent has-sub-menu"><a href=https://tunepolo.github.io/til/circleci/>CircleCI<span class="mark opened">-</span></a><ul class=sub-menu><li class=active><a href=https://tunepolo.github.io/til/circleci/convert_20_to_21/>2.1形式のファイルを2.0形式に変換する</a></li><li><a href=https://tunepolo.github.io/til/circleci/local_config_validate/>CircleCIの設定ファイルをローカルで検証する</a></li><li><a href=https://tunepolo.github.io/til/circleci/use_contexts/>Contextsを使う</a></li><li><a href=https://tunepolo.github.io/til/circleci/use_globstar/>globstarを使う</a></li><li><a href=https://tunepolo.github.io/til/circleci/separate_config/>設定ファイルを分割する</a></li><li><a href=https://tunepolo.github.io/til/circleci/auto-cancel_redundant_builds/>連続してトリガーされたビルドを自動キャンセルする</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/cygwin/>Cygwin<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/cygwin/create_etc_passwd/>/etc/passwdを作成する</a></li><li><a href=https://tunepolo.github.io/til/cygwin/open_from_context_menu/>フォルダーの右クリックからCygwinを開くメニューを追加する</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/docker/>Docker<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/docker/basic_command/>Dockerの基本操作</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/git/>Git<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/git/cloc/>clocでgit管理下にあるファイルだけを対象とする</a></li><li><a href=https://tunepolo.github.io/til/git/basic_secrets/>git secretsの基本操作</a></li><li><a href=https://tunepolo.github.io/til/git/submodule_pull_origin_master/>git submoduleで管理しているリポジトリをリモートの最新に追従させる</a></li><li><a href=https://tunepolo.github.io/til/git/submodule_delete/>git submoduleで管理しているリポジトリを削除する</a></li><li><a href=https://tunepolo.github.io/til/git/goenv/>goenvでインストールする</a></li><li><a href=https://tunepolo.github.io/til/git/access_right_handling/>アクセス権の扱い</a></li><li><a href=https://tunepolo.github.io/til/git/symbolic-ref/>ブランチ名に別名をつける</a></li><li><a href=https://tunepolo.github.io/til/git/ignore_ssl_verify/>自己証明書でホストされたgitリポジトリにアクセスする</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/gitbook/>GitBook<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/gitbook/basic_command/>Gitbookの基本操作</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/google-chrome/>Google Chrome<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/google-chrome/use_debugger/>Chromeのデバッガーを使う</a></li><li><a href=https://tunepolo.github.io/til/google-chrome/change_user-agent/>UserAgentを変更する</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/grpc/>gRPC<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/grpc/grpcurl/>grpcurl の使い方</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/heroku/>Heroku<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/heroku/basic_command/>Herokuコマンドの基本操作</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/homebrew/>Homebrew<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/homebrew/update_command/>Homebrew周りのアップデートコマンド</a></li><li><a href=https://tunepolo.github.io/til/homebrew/brew_bundle_dump/>インストールしたソフトウェアをファイルに書き出す</a></li><li><a href=https://tunepolo.github.io/til/homebrew/install_old_versionn/>古いバージョンのモジュールをインストールする</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/iterm2/>iTerm2<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/iterm2/enable_hotkey/>Hotkeyを有効化する</a></li><li><a href=https://tunepolo.github.io/til/iterm2/enable_status_bar/>ステータスバーを表示する</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/jenkins/>Jenkins<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/jenkins/change_session_timeout/>自動ログアウトまでの時間を長くする</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/mac/>Mac OS<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/mac/swap_ctrl_caps/>ControlキーとCaps Lockキーを入れ替える</a></li><li><a href=https://tunepolo.github.io/til/mac/show_secret_file_in_finder/>Finderで隠しファイルを表示する</a></li><li><a href=https://tunepolo.github.io/til/mac/split_view/>ウィンドウを並べて表示する</a></li><li><a href=https://tunepolo.github.io/til/mac/capture/>画面キャプチャを撮る</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/management/>Management<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/management/raci/>RACI</a></li><li><a href=https://tunepolo.github.io/til/management/xtheory_and_ytheory/>X理論とY理論</a></li><li><a href=https://tunepolo.github.io/til/management/barracuda_experiment/>カマスの実験</a></li><li><a href=https://tunepolo.github.io/til/management/tuckman_model/>タックマンモデル</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/node/>Node.js<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/node/support_policy/>Node.jsのサポート方針</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/npm/>npm<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/npm/npm_global_verup/>npmのバージョンを上げる</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/php/>PHP<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/php/php_strange_spec/>PHPのヘンテコ仕様</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/ruby/>Ruby<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/ruby/rbenv_basic/>rbenvの基本操作</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/ruby-on-rails/>Ruby on Rails<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/ruby-on-rails/basic_command/>Railsコマンドの基本操作</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/security/>Security<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/security/http_header_injection/>HTTPヘッダーインジェクション</a></li><li><a href=https://tunepolo.github.io/til/security/null_byte_attack/>Nullバイト攻撃</a></li><li><a href=https://tunepolo.github.io/til/security/os_command_injection/>OSコマンドインジェクション</a></li><li><a href=https://tunepolo.github.io/til/security/sql_injection/>SQLインジェクション</a></li><li><a href=https://tunepolo.github.io/til/security/csrf/>クロスサイトリクエストフォージェリ（CSRF）</a></li><li><a href=https://tunepolo.github.io/til/security/script_injection/>スクリプトインジェクション / クロスサイトスクリプティング（XSS）</a></li><li><a href=https://tunepolo.github.io/til/security/session_hijack/>セッションハイジャック</a></li><li><a href=https://tunepolo.github.io/til/security/directory_traversal/>ディレクトリトラバーサル</a></li><li><a href=https://tunepolo.github.io/til/security/file_upload_attack/>ファイルアップロード攻撃</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/seo/>SEO<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/seo/serp/>SERP</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/visual-studio/>Visual Studio<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/visual-studio/suppress_warning/>コンパイル時の警告を抑制する</a></li><li><a href=https://tunepolo.github.io/til/visual-studio/suppress_pdf_missing_warning/>ライブラリリンク時に'pdbファイルがない'警告を抑制する</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/web/>Web<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/web/performance_budget/>パフォーマンスバジェット</a></li></ul></li><li class=has-sub-menu><a href=https://tunepolo.github.io/til/windows/>Windows<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://tunepolo.github.io/til/windows/caps_to_ctrl/>CapsキーをCtrlにし、元のCtrlキーもそのままにするレジストリ設定</a></li><li><a href=https://tunepolo.github.io/til/windows/explorer_address_bar/>エクスプローラーのアドレスバーは"ファイル名を指定して実行"と同じことができる</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>